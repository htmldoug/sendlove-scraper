package com.rallyhealth.sendlove.client

import org.junit.Assert._
import org.junit.{Assert, Test}

class LovePageParserTest {
  @Test def parsesResponse() = {
    val raw = """{"body":"<tr class=\"roweven love_27674\"><td class=\"headFrom\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headTo\"><a href=\"daniel.staley\" target = \"_blank\">daniel.staley<\/a><\/td><td class=\"headFor\">unblocking NextEra through weekend affiliation help! pony<\/td><td class=\"headWhen\">1 hr ago<\/td><\/tr><tr class=\"rowodd love_27673\"><td class=\"headFrom\"><a href=\"daniel.staley\" target = \"_blank\">daniel.staley<\/a><\/td><td class=\"headTo\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headFor\">eagle eyes<\/td><td class=\"headWhen\">1 hr ago<\/td><\/tr><tr class=\"roweven love_27672\"><td class=\"headFrom\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headTo\"><a href=\"patrick.bohan\" target = \"_blank\">patrick.bohan<\/a><\/td><td class=\"headFor\">pushing dependencies down the tree. pony<\/td><td class=\"headWhen\">1 hr ago<\/td><\/tr><tr class=\"rowodd love_27669\"><td class=\"headFrom\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headTo\"><a href=\"bryan.lin\" target = \"_blank\">bryan.lin<\/a><\/td><td class=\"headFor\">really thorough PR review pony<\/td><td class=\"headWhen\">5 hrs ago<\/td><\/tr><tr class=\"roweven love_27667\"><td class=\"headFrom\"><a href=\"andrea.ho\" target = \"_blank\">andrea.ho<\/a><\/td><td class=\"headTo\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headFor\">uploading the missing link<\/td><td class=\"headWhen\">1 day ago<\/td><\/tr><tr class=\"rowodd love_27663\"><td class=\"headFrom\"><a href=\"andrea.ho\" target = \"_blank\">andrea.ho<\/a><\/td><td class=\"headTo\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headFor\">all your patience with me<\/td><td class=\"headWhen\">2 days ago<\/td><\/tr><tr class=\"roweven love_27645\"><td class=\"headFrom\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headTo\"><a href=\"rick.motzko\" target = \"_blank\">rick.motzko<\/a><\/td><td class=\"headFor\">PR comment annotations pony<\/td><td class=\"headWhen\">2 days ago<\/td><\/tr><tr class=\"rowodd love_27642\"><td class=\"headFrom\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headTo\"><a href=\"daniel.suarez\" target = \"_blank\">daniel.suarez<\/a><\/td><td class=\"headFor\">walk, talk, 'n coffee pony<\/td><td class=\"headWhen\">2 days ago<\/td><\/tr><tr class=\"roweven love_27641\"><td class=\"headFrom\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headTo\"><a href=\"Curt\" target = \"_blank\">Curt<\/a><\/td><td class=\"headFor\">survey PR link pony<\/td><td class=\"headWhen\">2 days ago<\/td><\/tr><tr class=\"rowodd love_27634\"><td class=\"headFrom\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headTo\"><a href=\"Curt\" target = \"_blank\">Curt<\/a><\/td><td class=\"headFor\">field medic pony<\/td><td class=\"headWhen\">2 days ago<\/td><\/tr><tr class=\"roweven love_27633\"><td class=\"headFrom\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headTo\"><a href=\"chris.salij\" target = \"_blank\">chris.salij<\/a><\/td><td class=\"headFor\">darmok and jalad at tanagra pony<\/td><td class=\"headWhen\">2 days ago<\/td><\/tr><tr class=\"rowodd love_27632\"><td class=\"headFrom\"><a href=\"chris.salij\" target = \"_blank\">chris.salij<\/a><\/td><td class=\"headTo\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headFor\">ship's councillor<\/td><td class=\"headWhen\">2 days ago<\/td><\/tr><tr class=\"roweven love_27631\"><td class=\"headFrom\"><a href=\"Curt\" target = \"_blank\">Curt<\/a><\/td><td class=\"headTo\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headFor\">helping me \"resolve\" my issues (troll)<\/td><td class=\"headWhen\">2 days ago<\/td><\/tr><tr class=\"rowodd love_27619\"><td class=\"headFrom\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headTo\"><a href=\"robert.murphy\" target = \"_blank\">robert.murphy<\/a><\/td><td class=\"headFor\">artifactory (doge) much love<\/td><td class=\"headWhen\">2 days ago<\/td><\/tr><tr class=\"roweven love_27614\"><td class=\"headFrom\"><a href=\"dougernaut\" target = \"_blank\">dougernaut<\/a><\/td><td class=\"headTo\"><a href=\"nick.sovich\" target = \"_blank\">nick.sovich<\/a><\/td><td class=\"headFor\">taking the artifactory publish docs off my plate! pony<\/td><td class=\"headWhen\">2 days ago<\/td><\/tr>","pager":"<ul class=\"pager\"><li class=\"page current\">1<\/li><li class=\"otherPage\">2<\/li><li class=\"otherPage\">3<\/li><li class=\"otherPage\">4<\/li><li class=\"otherPage\">5<\/li><li class=\"otherPage\">6<\/li><li class=\"otherPage\">7<\/li><li class=\"otherPage\">8<\/li><li class=\"otherPage\">9<\/li><li class=\"otherPage\">10<\/li><li class=\"morePage\">...<\/li><li class=\"next\">&gt;<\/li><li class=\"lastPage\" lastPage=\"277\">&gt;&gt;<\/li><\/ul>"}"""
    val parsed = new LovePageParser().parse(raw)
    val first = parsed.head
    assertEquals("27674", first.id)
    assertEquals("dougernaut", first.fromUsername)
    assertEquals("daniel.staley", first.toUsername)
    assertEquals("unblocking NextEra through weekend affiliation help! pony", first.content)
    assertEquals("1 hr ago", first.age)
  }
}
